<?xml version="1.0" encoding="UTF-8"?>
<processing xmlns="http://kabeja.org/processing/1.0" xmlns:xi="http://www.w3.org/2001/XInclude">
	<!--+
	    | The processing configuration  
	    +-->
	<configuration>
	  <!--+ 
	      |not yet implemented, but will follow: the parser configuration
	      |<xi:include href="parser.xml"/>
	      +-->
	
		<postprocessors>
			<postprocessor class="org.kabeja.processing.BoundsDebugger" name="bounds.debugger"/>
			<!--  removes all image entities if the images file does not exists -->
			<postprocessor class="org.kabeja.processing.ImageFilter" name="image.filter"/>
			<postprocessor class="org.kabeja.processing.BoundsFilter" name="bounds.filter"/>
			<!-- allows you to remove layers from the draft and merge all layers to one -->
			<postprocessor class="org.kabeja.processing.LayerFilter" name="layer.filter"/>
            <!--  converts lines,arcs and polylines to a single polyline, if they have the same points -->
			<postprocessor class="org.kabeja.processing.PolylineConverter" name="polyline.converter"/>
			<!-- removes invisible entities -->		
			<postprocessor class="org.kabeja.processing.VisibilityFilter" name="visibility.filter"/>
		</postprocessors>
		
		<filters>
			<filter class="org.kabeja.batik.tools.ImageBase64Encoder" name="image"/>
			<filter class="org.kabeja.xslt.SAXXSLTFilter" name="xslt">
				<property name="http://xml.org/sax/features/is-standalone/" value="true"/>
			</filter>
			<filter class="org.kabeja.xml.FixedStrokeWidthFilter" name="fixed-stroke-width"/>
		</filters>
		
		<serializers>
			<serializer class="org.kabeja.xml.SAXPrettyOutputter" name="svg"/>
			<serializer class="org.kabeja.batik.tools.SAXJPEGSerializer" name="jpeg"/>
			<serializer class="org.kabeja.batik.tools.SAXPNGSerializer" name="png"/>
			<serializer class="org.kabeja.batik.tools.SAXTIFFSerializer" name="tiff"/>
			<serializer class="org.kabeja.batik.tools.SAXPDFSerializer" name="pdf"/>
			<serializer class="org.kabeja.xslt.SAXXMLSerializer" name="xml"/>
		</serializers>
		
		<generators>
			<generator class="org.kabeja.svg.SVGGenerator" name="svg"/>
		</generators>
		
	</configuration>
	
	<!--+
	    | The processing pipelines 
	    +-->
	
	<pipelines>
	
		<pipeline name="svg">
		    <generate name="svg"/>
			<serialize name="svg"/>
		</pipeline>
		
		
		<pipeline name="debug">
			<postprocess name="bounds.debugger"/>
			<generate name="svg"/>
			<filter name="image"/>
			<serialize name="svg"/>
		</pipeline>
		
		
		<pipeline name="jpeg">
			<generate name="svg"/>
			<serialize name="jpeg">
				<property name="width" value="1024"/>
				<property name="height" value="768"/>
			</serialize>
		</pipeline>
		
		<pipeline name="png">
			<generate name="svg"/>
			<serialize name="png">
				<property name="width" value="1024"/>
				<property name="height" value="768"/>
			</serialize>
		</pipeline>

		<pipeline name="tiff">
			<generate name="svg"/>
			<serialize name="tiff">
				<property name="width" value="1024"/>
				<property name="height" value="768"/>
			</serialize>
		</pipeline>
		
		<pipeline name="pdf">
		  	<generate name="svg"/>
			<serialize name="pdf"/>
		</pipeline>
		
		
		<pipeline name="font">
		  	<generate name="svg"/>
			<filter name="xslt">
				<property name="stylesheet" value="../tools/xsl/embedfont.xsl"/>
			</filter>
			<serialize name="svg"/>
		</pipeline>
		
		
		<pipeline name="xml">
		    <generate name="svg"/>
			<serialize name="xml"/>
		</pipeline>
		
		
		<pipeline name="embed">
			<postprocess name="image.filter"/>
			<generate name="svg"/>
			<filter name="image"/>
			<filter name="xslt">
				<property name="stylesheet" value="../tools/xsl/embedfont.xsl"/>
				<property name="http://xml.org/sax/features/is-standalone/" value="true"/>
				<property name="http://xml.org/sax/features/external-general-entities" value="false"/>
			</filter>
			<serialize name="svg"/>
		</pipeline>
			
	   <pipeline name="mozilla">
	        <generate name="svg"/>
	        <!--  Mozilla based browser only render svg with a 
	              fixed stroke-width, a percent value will cause a
	              crashing Mozilla -->
	        <filter name="fixed-stroke-width"/>
	        <serialize name="svg"/>
	   </pipeline>
			
			
	</pipelines>
	
	
</processing>
